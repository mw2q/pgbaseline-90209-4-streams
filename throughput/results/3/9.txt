BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%misty%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272154500.117908
 ALGERIA                   |   1997 | 455107311.106881
 ALGERIA                   |   1996 | 463942392.712627
 ALGERIA                   |   1995 | 468803170.805433
 ALGERIA                   |   1994 | 459692066.833037
 ALGERIA                   |   1993 | 456206571.608241
 ALGERIA                   |   1992 | 458107642.981223
 ARGENTINA                 |   1998 | 279863016.329426
 ARGENTINA                 |   1997 | 462164333.350304
 ARGENTINA                 |   1996 |  467834687.10161
 ARGENTINA                 |   1995 | 468562214.964095
 ARGENTINA                 |   1994 | 466304976.931675
 ARGENTINA                 |   1993 | 464196184.505355
 ARGENTINA                 |   1992 | 469921780.008059
 BRAZIL                    |   1998 | 267542528.889429
 BRAZIL                    |   1997 | 464786666.308173
 BRAZIL                    |   1996 | 457289751.575417
 BRAZIL                    |   1995 | 463769040.552721
 BRAZIL                    |   1994 | 450125078.564042
 BRAZIL                    |   1993 | 457276090.661363
 BRAZIL                    |   1992 | 464327974.605267
 CANADA                    |   1998 | 276134871.181893
 CANADA                    |   1997 | 473487921.446073
 CANADA                    |   1996 | 466451728.257177
 CANADA                    |   1995 | 471306905.774411
 CANADA                    |   1994 | 478510662.766775
 CANADA                    |   1993 | 476613209.458582
 CANADA                    |   1992 | 477960261.845298
 CHINA                     |   1998 | 272333485.850059
 CHINA                     |   1997 | 458831808.393636
 CHINA                     |   1996 | 472312474.639632
 CHINA                     |   1995 | 469383960.122313
 CHINA                     |   1994 | 466232963.793018
 CHINA                     |   1993 | 470127174.044783
 CHINA                     |   1992 | 460660187.203781
 EGYPT                     |   1998 | 267707738.203887
 EGYPT                     |   1997 | 461478883.153487
 EGYPT                     |   1996 | 467025102.963722
 EGYPT                     |   1995 | 456794859.765643
 EGYPT                     |   1994 |  448213830.19245
 EGYPT                     |   1993 | 462089671.571879
 EGYPT                     |   1992 | 459678855.638632
 ETHIOPIA                  |   1998 | 273600133.838589
 ETHIOPIA                  |   1997 | 455161003.946466
 ETHIOPIA                  |   1996 | 455866618.032669
 ETHIOPIA                  |   1995 | 450289077.338271
 ETHIOPIA                  |   1994 | 452530564.191014
 ETHIOPIA                  |   1993 |  461119185.15134
 ETHIOPIA                  |   1992 | 459040436.748347
 FRANCE                    |   1998 | 269739810.918672
 FRANCE                    |   1997 |  464465277.10952
 FRANCE                    |   1996 | 466973288.026458
 FRANCE                    |   1995 | 462729555.791931
 FRANCE                    |   1994 | 470313412.479212
 FRANCE                    |   1993 | 464379304.375222
 FRANCE                    |   1992 | 460245796.063804
 GERMANY                   |   1998 | 277709713.040621
 GERMANY                   |   1997 | 474392502.802495
 GERMANY                   |   1996 | 468017879.371076
 GERMANY                   |   1995 | 480309344.646126
 GERMANY                   |   1994 |  472511486.30861
 GERMANY                   |   1993 | 472176619.545587
 GERMANY                   |   1992 |   467530897.9659
 INDIA                     |   1998 | 272332419.867604
 INDIA                     |   1997 | 473267372.711245
 INDIA                     |   1996 |  476998027.11486
 INDIA                     |   1995 | 473593871.951876
 INDIA                     |   1994 |  476649132.42198
 INDIA                     |   1993 |   470706060.6652
 INDIA                     |   1992 | 471107619.177084
 INDONESIA                 |   1998 | 274483123.310124
 INDONESIA                 |   1997 | 461237097.720623
 INDONESIA                 |   1996 | 465673081.611766
 INDONESIA                 |   1995 | 463311302.828952
 INDONESIA                 |   1994 | 458816108.136479
 INDONESIA                 |   1993 | 457940667.067623
 INDONESIA                 |   1992 | 455713130.995458
 IRAN                      |   1998 | 270960964.889165
 IRAN                      |   1997 | 459685630.508277
 IRAN                      |   1996 | 459817113.547364
 IRAN                      |   1995 | 464253036.982423
 IRAN                      |   1994 | 452691743.320733
 IRAN                      |   1993 | 461968021.477724
 IRAN                      |   1992 |  466248869.91613
 IRAQ                      |   1998 | 279999114.678718
 IRAQ                      |   1997 | 465328078.909773
 IRAQ                      |   1996 | 476408252.822872
 IRAQ                      |   1995 |  473084904.58446
 IRAQ                      |   1994 | 477371477.531882
 IRAQ                      |   1993 | 466421950.678022
 IRAQ                      |   1992 | 474819890.866966
 JAPAN                     |   1998 | 262318563.444802
 JAPAN                     |   1997 | 464790804.964936
 JAPAN                     |   1996 | 461116536.472725
 JAPAN                     |   1995 | 458198407.427009
 JAPAN                     |   1994 | 454367515.177405
 JAPAN                     |   1993 | 460988164.079335
 JAPAN                     |   1992 | 460539621.187384
 JORDAN                    |   1998 |  270871180.36479
 JORDAN                    |   1997 |  461910294.21212
 JORDAN                    |   1996 | 459827287.519914
 JORDAN                    |   1995 | 461146951.351283
 JORDAN                    |   1994 | 459113355.517722
 JORDAN                    |   1993 | 472342984.389791
 JORDAN                    |   1992 | 459753920.866594
 KENYA                     |   1998 |  280818402.91028
 KENYA                     |   1997 | 462778309.106881
 KENYA                     |   1996 | 473601542.423176
 KENYA                     |   1995 | 472975659.036596
 KENYA                     |   1994 | 477828238.067388
 KENYA                     |   1993 |  472494602.77528
 KENYA                     |   1992 | 476037040.990336
 MOROCCO                   |   1998 | 272992799.478166
 MOROCCO                   |   1997 | 470329836.048798
 MOROCCO                   |   1996 | 477752862.221673
 MOROCCO                   |   1995 | 470893946.396188
 MOROCCO                   |   1994 |  470217604.15192
 MOROCCO                   |   1993 | 466913367.039433
 MOROCCO                   |   1992 | 469286953.996369
 MOZAMBIQUE                |   1998 | 275415917.329608
 MOZAMBIQUE                |   1997 | 465269455.511762
 MOZAMBIQUE                |   1996 | 473396779.825246
 MOZAMBIQUE                |   1995 | 467742596.888303
 MOZAMBIQUE                |   1994 | 465419586.025768
 MOZAMBIQUE                |   1993 | 465819405.780383
 MOZAMBIQUE                |   1992 | 458089626.833748
 PERU                      |   1998 | 265750655.539365
 PERU                      |   1997 | 457105175.590745
 PERU                      |   1996 |  467445701.22946
 PERU                      |   1995 | 463300051.516985
 PERU                      |   1994 | 459405040.879718
 PERU                      |   1993 | 453353136.219411
 PERU                      |   1992 | 464303267.562578
 ROMANIA                   |   1998 | 278611400.803436
 ROMANIA                   |   1997 | 478339022.933858
 ROMANIA                   |   1996 | 477267191.978031
 ROMANIA                   |   1995 | 467617414.407423
 ROMANIA                   |   1994 | 473463326.012578
 ROMANIA                   |   1993 | 469673219.069995
 ROMANIA                   |   1992 | 470700760.934271
 RUSSIA                    |   1998 |  272587016.25957
 RUSSIA                    |   1997 | 464525327.699911
 RUSSIA                    |   1996 | 465005503.382201
 RUSSIA                    |   1995 | 468684019.389585
 RUSSIA                    |   1994 | 462714533.619124
 RUSSIA                    |   1993 | 464485508.758154
 RUSSIA                    |   1992 |  464792780.17022
 SAUDI ARABIA              |   1998 | 277524515.222187
 SAUDI ARABIA              |   1997 | 467625270.842671
 SAUDI ARABIA              |   1996 | 465736930.108591
 SAUDI ARABIA              |   1995 | 475517151.631413
 SAUDI ARABIA              |   1994 |   467543680.6383
 SAUDI ARABIA              |   1993 | 470307290.663052
 SAUDI ARABIA              |   1992 | 473846394.985356
 UNITED KINGDOM            |   1998 | 269257378.155579
 UNITED KINGDOM            |   1997 |   455643150.1196
 UNITED KINGDOM            |   1996 | 449384197.031698
 UNITED KINGDOM            |   1995 | 458260031.522383
 UNITED KINGDOM            |   1994 | 459111957.331869
 UNITED KINGDOM            |   1993 | 458091693.167606
 UNITED KINGDOM            |   1992 |  446280359.19771
 UNITED STATES             |   1998 | 274213510.186298
 UNITED STATES             |   1997 | 483362840.103713
 UNITED STATES             |   1996 | 480365180.946521
 UNITED STATES             |   1995 |  472439862.03694
 UNITED STATES             |   1994 | 476770449.170609
 UNITED STATES             |   1993 | 475331331.935334
 UNITED STATES             |   1992 |  477518038.25685
 VIETNAM                   |   1998 | 273520625.063499
 VIETNAM                   |   1997 | 466737015.849205
 VIETNAM                   |   1996 | 476710675.204364
 VIETNAM                   |   1995 | 457837303.655642
 VIETNAM                   |   1994 |  464623911.52505
 VIETNAM                   |   1993 | 464726304.263879
 VIETNAM                   |   1992 | 473523770.606663
(175 rows)

COMMIT;
COMMIT
